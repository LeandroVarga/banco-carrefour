%% Sequence: POST entry -> outbox -> broker -> consolidator -> query
sequenceDiagram
  participant M as Merchant
  participant G as API Gateway
  participant L as Ledger Service
  participant MQ as RabbitMQ
  participant C as Consolidator
  participant DB as Postgres
  participant Q as Balance Query

  M->>G: POST /ledger/entries
  G->>L: Forward request
  L->>DB: Save entry + outbox
  L-->>M: 201 Created (id)
  L->>MQ: Publish ledger.entry-recorded
  MQ-->>C: Deliver event
  C->>DB: Upsert report.daily_balances
  M->>G: GET /balances/daily?date=YYYY-MM-DD
  G->>Q: Forward request
  Q->>DB: Read report.daily_balances
  Q-->>M: { day, balanceCents }

