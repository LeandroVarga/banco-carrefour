%% C4 Context Diagram
flowchart LR
  Merchant((Merchant))
  Gateway[API Gateway]
  Ledger[Ledger Service]
  Consolidator[Consolidator Service]
  Query[Balance Query Service]
  DB[(PostgreSQL: ledger & report schemas)]
  MQ[(RabbitMQ)]

  Merchant -->|HTTP /ledger, /balances| Gateway
  Gateway --> Ledger
  Gateway --> Query
  Gateway --> Consolidator
  Ledger --> DB
  Ledger -->|Outbox -> Events| MQ
  MQ --> Consolidator
  Consolidator --> DB
  Query --> DB

%% Business capabilities
%% - Ledger: Record entry
%% - Consolidator: Consolidate daily balances
%% - Balance-Query: Query balances
%% - Gateway: Edge/rate-limit
